# Generated by Django 5.2.6 on 2025-11-24 06:52

from django.db import migrations, models


def convert_actual_result_values_forward(apps, schema_editor):
    """
    Convert actual_result values from old format to new format:
    Old: '1' = Team A, '3' = Team B, '0' = Draw
    New: '3' = Team A, '0' = Team B, '1' = Draw
    """
    Match = apps.get_model('matches', 'Match')
    
    # Conversion mapping
    value_map = {
        '1': '3',  # Old Team A → New Team A
        '3': '0',  # Old Team B → New Team B
        '0': '1',  # Old Draw → New Draw
    }
    
    # Convert all actual_result fields
    for match in Match.objects.exclude(actual_result__isnull=True).exclude(actual_result=''):
        if match.actual_result in value_map:
            match.actual_result = value_map[match.actual_result]
            match.save()


def convert_actual_result_values_backward(apps, schema_editor):
    """
    Reverse conversion (for rollback):
    New: '3' = Team A, '0' = Team B, '1' = Draw
    Old: '1' = Team A, '3' = Team B, '0' = Draw
    """
    Match = apps.get_model('matches', 'Match')
    
    # Reverse conversion mapping
    value_map = {
        '3': '1',  # New Team A → Old Team A
        '0': '3',  # New Team B → Old Team B
        '1': '0',  # New Draw → Old Draw
    }
    
    # Convert all actual_result fields back
    for match in Match.objects.exclude(actual_result__isnull=True).exclude(actual_result=''):
        if match.actual_result in value_map:
            match.actual_result = value_map[match.actual_result]
            match.save()


class Migration(migrations.Migration):

    dependencies = [
        ('matches', '0002_match_country_match_game_title_match_week_number'),
    ]

    operations = [
        # First convert data
        migrations.RunPython(convert_actual_result_values_forward, convert_actual_result_values_backward),
        # Then alter field choices
        migrations.AlterField(
            model_name='match',
            name='actual_result',
            field=models.CharField(blank=True, choices=[('3', 'Team A Win'), ('1', 'Draw'), ('0', 'Team B Win')], help_text='Actual match result: 3=Team A, 1=Draw, 0=Team B', max_length=1, null=True, verbose_name='Actual Result'),
        ),
    ]
